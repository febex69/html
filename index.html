<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hotline-ish Retro v4</title>
<style>
:root{
--bg:#0b0b10; --accent:#ff2d95; --accent2:#00e6ff; --enemy:#ff3f3f; --hud:#c9c9c9;
}
html,body{height:100%;margin:0;background:var(--bg);font-family:Arial,sans-serif;display:flex;align-items:center;justify-content:center;overflow:hidden;color:var(--hud);}
#container{position:relative;width:960px;height:640px;box-shadow:0 12px 40px rgba(0,0,0,0.8);border-radius:6px;overflow:hidden;background:linear-gradient(180deg,#0b0b10,#06060a);}
canvas{display:block;background:transparent;margin:0;}
#hud{position:absolute;left:12px;top:10px;z-index:8;font-size:14px}
.hud-line{margin-bottom:6px}
.bar-wrap{width:200px;height:10px;background:rgba(255,255,255,0.06);border-radius:6px;overflow:hidden;display:inline-block;vertical-align:middle;margin-left:8px}
.bar{height:100%;background:linear-gradient(90deg,var(--accent),#ff7ab8);width:100%}
#menu{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;z-index:10;background:rgba(0,0,0,0.6)}
.menu-box{width:400px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);padding:18px;border-radius:10px;text-align:center}
h1{color:var(--accent);margin:6px 0 4px;font-size:22px}
p.desc{color:rgba(255,255,255,0.7);font-size:13px;margin:0 0 12px}
.weapons{display:flex;gap:8px;justify-content:center;margin-bottom:12px}
.weapon-btn{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);cursor:pointer;position:relative}
.weapon-btn.locked{opacity:0.45;cursor:default}
.weapon-btn.selected{outline:2px solid rgba(255,255,255,0.08)}
.weapon-lock{position:absolute;right:8px;top:8px;font-size:12px;color:rgba(255,255,255,0.6)}
.level-select{display:flex;gap:8px;margin-bottom:12px}
.level-btn{flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);cursor:pointer}
.start-row{display:flex;gap:8px;justify-content:center;align-items:center}
button.start{padding:10px 16px;border-radius:8px;border:none;background:var(--accent);color:#111;font-weight:700;cursor:pointer}
button.start.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--hud)}
.meta{font-size:12px;color:rgba(255,255,255,0.6);margin-top:8px}
#scoreBox{position:absolute;right:12px;top:10px;z-index:8;text-align:right}
</style>
</head>
<body>
<div id="container">
<canvas id="game" width="960" height="640"></canvas>
<div id="hud">
<div class="hud-line">Liv: <span id="hpText">100</span>
<span class="bar-wrap"><span class="bar" id="hpBar" style="width:100%"></span></span>
</div>
<div class="hud-line">Våben: <span id="weaponName">Pistol</span></div>
</div>
<div id="scoreBox"><div>Score: <span id="scoreText">0</span></div></div>
<div id="menu" aria-hidden="false">
<div class="menu-box">
<h1>Hotline-ish Retro v4</h1>
<p class="desc">Klik våben for at vælge. WASD = bevæg, mus = sigt & skyd. Shotgun og SMG låses op efter levels.</p>
<div class="weapons" id="weapons">
<div class="weapon-btn selected" data-id="pistol" id="w-pistol"><div style="font-weight:700">Pistol</div><div style="font-size:12px;color:rgba(255,255,255,0.7)">Hurtig, enkelt skud</div></div>
<div class="weapon-btn locked" data-id="shotgun" id="w-shotgun"><div style="font-weight:700">Shotgun</div><div style="font-size:12px;color:rgba(255,255,255,0.7)">Langsom, spread</div><div class="weapon-lock">Locked</div></div>
<div class="weapon-btn locked" data-id="smg" id="w-smg"><div style="font-weight:700">SMG</div><div style="font-size:12px;color:rgba(255,255,255,0.7)">Hurtig, lav damage</div><div class="weapon-lock">Locked</div></div>
</div>
<div class="level-select">
<div class="level-btn" data-level="1" id="lv1">Level 1 (clear)</div>
<div class="level-btn" data-level="inf" id="lvinf">Level Infinite</div>
</div>
<div class="start-row">
<button class="start" id="startBtn">Start spil</button>
</div>
<div class="meta">R = genstart mid-game • Space = melee</div>
</div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded',()=>{

const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
const menu=document.getElementById('menu');
const startBtn=document.getElementById('startBtn');
const wPistol=document.getElementById('w-pistol');
const wShotgun=document.getElementById('w-shotgun');
const wSMG=document.getElementById('w-smg');
const hpText=document.getElementById('hpText');
const hpBar=document.getElementById('hpBar');
const weaponName=document.getElementById('weaponName');
const scoreText=document.getElementById('scoreText');
const lv1Btn=document.getElementById('lv1');
const lvinfBtn=document.getElementById('lvinf');

let W=canvas.width,H=canvas.height;
let keys={},mouse={x:W/2,y:H/2,down:false};
let player,bullets=[],enemies=[],walls=[],score=0,running=false,levelConfig=null,currentLevel=null;
let selectedWeapon='pistol',shotgunUnlocked=false,smgUnlocked=false,levelChoice='1';
let spawnCount=0,totalSpawned=0,lastSpawnTime=0;

const LEVELS={'1':{name:'Level 1',type:'finite',initial:6,maxTotalSpawns:18,spawnRate:1200,walls:makeWallsLevel1()},'inf':{name:'Infinite',type:'infinite',initial:4,spawnRate:900,walls:makeWallsLevel2()}};
const WEAPONS={pistol:{name:'Pistol',fireRate:300,bulletSpeed:9,damage:34,pellets:1},shotgun:{name:'Shotgun',fireRate:600,bulletSpeed:8,damage:22,pellets:7,spread:0.6},smg:{name:'SMG',fireRate:90,bulletSpeed:10,damage:12,pellets:1}};

// --- event listeners
window.addEventListener('keydown',e=>{keys[e.key.toLowerCase()]=true;if(e.key==='r')restartLevel();if(e.code==='Space')playerMelee();});
window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);
canvas.addEventListener('mousemove',e=>{const r=canvas.getBoundingClientRect();mouse.x=e.clientX-r.left;mouse.y=e.clientY-r.top;});
canvas.addEventListener('mousedown',()=>{mouse.down=true;});
window.addEventListener('mouseup',()=>{mouse.down=false;});

wPistol.addEventListener('click',()=>{selectWeapon('pistol');});
wShotgun.addEventListener('click',()=>{if(shotgunUnlocked)selectWeapon('shotgun');});
wSMG.addEventListener('click',()=>{if(smgUnlocked)selectWeapon('smg');});
lv1Btn.addEventListener('click',()=>{levelChoice='1';highlightLevel();});
lvinfBtn.addEventListener('click',()=>{levelChoice='inf';highlightLevel();});
startBtn.addEventListener('click',()=>{startLevel(levelChoice);});

function highlightLevel(){if(levelChoice==='1'){lv1Btn.style.outline='2px solid rgba(255,255,255,0.06)';lvinfBtn.style.outline='';}else{lvinfBtn.style.outline='2px solid rgba(255,255,255,0.06)';lv1Btn.style.outline='';}}
function selectWeapon(id){selectedWeapon=id;[wPistol,wShotgun,wSMG].forEach(el=>el.classList.remove('selected'));if(id==='pistol')wPistol.classList.add('selected');else if(id==='shotgun')wShotgun.classList.add('selected');else wSMG.classList.add('selected');weaponName.textContent=WEAPONS[selectedWeapon].name;}

function makeWallsLevel1(){return [{x:0,y:0,w:960,h:12},{x:0,y:628,w:960,h:12},{x:0,y:0,w:12,h:640},{x:948,y:0,w:12,h:640},{x:120,y:80,w:160,h:200},{x:320,y:80,w:12,h:200},{x:520,y:180,w:200,h:12},{x:200,y:360,w:420,h:20},{x:760,y:220,w:12,h:200},{x:40,y:520,w:150,h:12}];}
function makeWallsLevel2(){return [{x:0,y:0,w:960,h:12},{x:0,y:628,w:960,h:12},{x:0,y:0,w:12,h:640},{x:948,y:0,w:12,h:640},{x:100,y:120,w:220,h:12},{x:100,y:120,w:12,h:120},{x:320,y:120,w:12,h:120},{x:420,y:220,w:220,h:12},{x:620,y:220,w:12,h:120},{x:260,y:400,w:360,h:12},{x:260,y:300,w:12,h:120}];}

// --- spawn enemy
function spawnEnemy(){const edge=Math.floor(Math.random()*4);let x=0,y=0;if(edge===0)x=20,y=40+Math.random()*(H-80);if(edge===1)x=W-20,y=40+Math.random()*(H-80);if(edge===2)x=40+Math.random()*(W-80),y=20;if(edge===3)x=40+Math.random()*(W-80),y=H-20;enemies.push({x,y,r:12,hp:70+Math.floor(Math.random()*30),attackCooldown:0});spawnCount++;totalSpawned++;}

// --- start level
function startLevel(levelId){
currentLevel=LEVELS[levelId];
levelConfig={...currentLevel};
bullets=[];enemies=[];score=0;spawnCount=0;totalSpawned=0;lastSpawnTime=0;
player={x:480,y:320,r:12,speed:2.6,hp:100,facing:0,meleeCooldown:0,lastShot:0};
walls=JSON.parse(JSON.stringify(levelConfig.walls||[]));
running=true;menu.style.display='none';hpText.textContent=player.hp;hpBar.style.width='100%';weaponName.textContent=WEAPONS[selectedWeapon].name;scoreText.textContent=score;
for(let i=0;i<(levelConfig.initial||4);i++)spawnEnemy();
highlightLevel();
}

// --- restart
function restartLevel(){if(!running)return;startLevel(levelChoice);}

// --- helper functions
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
function dist(ax,ay,bx,by){return Math.hypot(ax-bx,ay-by);}
function circleRectCollide(cx,cy,cr,rect){const rx=clamp(cx,rect.x,rect.x+rect.w);const ry=clamp(cy,rect.y,rect.y+rect.h);const dx=cx-rx,dy=cy-ry;return(dx*dx+dy*dy)<(cr*cr);}
function tryMove(obj,vx,vy){let nx=obj.x+vx,ny=obj.y+vy;for(const w of walls){if(circleRectCollide(nx,ny,obj.r,w)){if(!circleRectCollide(obj.x+vx,obj.y,obj.r,w))nx=obj.x+vx,ny=obj.y;else if(!circleRectCollide(obj.x,obj.y+vy,obj.r,w))nx=obj.x,ny=obj.y+vy;else nx=obj.x,ny=obj.y;}}obj.x=clamp(nx,obj.r+6,W-obj.r-6);obj.y=clamp(ny,obj.r+6,H-obj.r-6);}
function playerShoot(){const wep=WEAPONS[selectedWeapon];const now=performance.now();if(now-player.lastShot<wep.fireRate)return;player.lastShot=now;const angle=Math.atan2(mouse.y-player.y,mouse.x-player.x);if(wep.pellets<=1)bullets.push({x:player.x+Math.cos(angle)*(player.r+8),y:player.y+Math.sin(angle)*(player.r+8),vx:Math.cos(angle)*wep.bulletSpeed,vy:Math.sin(angle)*wep.bulletSpeed,life:60,damage:wep.damage});else{const spread=wep.spread||0.5;const p=wep.pellets;for(let i=0;i<p;i++){const a=angle+(Math.random()-0.5)*spread;bullets.push({x:player.x+Math.cos(a)*(player.r+8),y:player.y+Math.sin(a)*(player.r+8),vx:Math.cos(a)*wep.bulletSpeed,vy:Math.sin(a)*wep.bulletSpeed,life:50,damage:wep.damage});}}}

function playerMelee(){if(!running)return;if(player.meleeCooldown&&player.meleeCooldown>0)return;player.meleeCooldown=36;for(const e of enemies){if(dist(player.x,player.y,e.x,e.y)<player.r+e.r+12)e.hp-=48;}}

// --- game loop
let lastTime=performance.now();
function loop(now){
const dt=now-lastTime;lastTime=now;if(!running)return;
if(levelConfig.type==='infinite'){if(now-lastSpawnTime>levelConfig.spawnRate)spawnEnemy(),lastSpawnTime=now;}else{if(totalSpawned<(levelConfig.maxTotalSpawns||30)&&now-lastSpawnTime>levelConfig.spawnRate)spawnEnemy(),lastSpawnTime=now;}
let dx=0,dy=0;if(keys['w']||keys['arrowup'])dy-=1;if(keys['s']||keys['arrowdown'])dy+=1;if(keys['a']||keys['arrowleft'])dx-=1;if(keys['d']||keys['arrowright'])dx+=1;if(dx||dy){const mag=Math.hypot(dx,dy);dx/=mag;dy/=mag;tryMove(player,dx*player.speed,dy*player.speed);}
if(mouse.down)playerShoot();

// update bullets
for(let i=bullets.length-1;i>=0;i--){const b=bullets[i];b.x+=b.vx;b.y+=b.vy;b.life--;let collided=false;for(const w of walls)if(circleRectCollide(b.x,b.y,3,w))collided=true;if(collided||b.life<=0||b.x<0||b.x>W||b.y<0||b.y>H){bullets.splice(i,1);continue;}for(const e of enemies)if(dist(b.x,b.y,e.x,e.y)<e.r+3){e.hp-=b.damage;bullets.splice(i,1);break;}}

// update enemies
for(let i=enemies.length-1;i>=0;i--){const e=enemies[i];if(e.hp<=0){enemies.splice(i,1);score+=100;scoreText.textContent=score;continue;}const angle=Math.atan2(player.y-e.y,player.x-e.x);tryMove(e,Math.cos(angle)*1.2,Math.sin(angle)*1.2);if(dist(e.x,e.y,player.x,player.y)<e.r+player.r+6&&(e.attackCooldown||0)<=0){player.hp-=10;e.attackCooldown=40;if(player.hp<0)player.hp=0;}if(e.attackCooldown&&e.attackCooldown>0)e.attackCooldown--;}

// player cooldowns
if(player.meleeCooldown&&player.meleeCooldown>0)player.meleeCooldown--;
hpText.textContent=Math.max(0,player.hp);hpBar.style.width=Math.max(0,(player.hp/100)*100)+'%';
if(player.hp<=0&&running){running=false;menu.style.display='flex';menu.querySelector('h1').textContent='Game Over';menu.querySelector('.desc').textContent='Du døde — prøv igen.';}

draw();requestAnimationFrame(loop);}

// --- draw function
function draw(){
ctx.clearRect(0,0,W,H);
for(const w of walls){ctx.fillStyle='rgba(120,120,120,0.5)';ctx.fillRect(w.x,w.y,w.w,w.h);}
ctx.strokeStyle='var(--accent)';ctx.lineWidth=2;
ctx.beginPath();ctx.moveTo(player.x,player.y);ctx.lineTo(mouse.x,mouse.y);ctx.stroke();
ctx.fillStyle='var(--accent2)';ctx.beginPath();ctx.arc(player.x,player.y,player.r,0,Math.PI*2);ctx.fill();
ctx.fillStyle='var(--enemy)';for(const e of enemies){ctx.beginPath();ctx.arc(e.x,e.y,e.r,0,Math.PI*2);ctx.fill();}
ctx.fillStyle='var(--accent)';for(const b of bullets){ctx.beginPath();ctx.arc(b.x,b.y,3,0,Math.PI*2);ctx.fill();}}
requestAnimationFrame(loop);

});
</script>
</body>
</html>
